<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Romain Tavenard" />
  <title>An introduction to Dynamic Time Warping</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="https://latex.now.sh/style.css">
  <link rel="stylesheet" href="https://latex.now.sh/prism/prism.css">
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
</head>
<body>
<div id="header">
<h1 class="title">An introduction to Dynamic Time Warping</h1>
<h2 class="author">Romain Tavenard</h2>
<h3 class="date">2021/04/21</h3>
</div>
<h1 data-number="1" id="alignment-based-metrics"><span class="header-section-number">1</span> Alignment-based metrics</h1>
<p>The definition of adequate metrics between objects to be compared is at the core of many machine learning methods (<em>e.g.</em>, nearest neighbors, kernel machines, <em>etc.</em>). When complex objects (such as time series) are involved, such metrics have to be carefully designed in order to leverage on desired notions of similarity.</p>
<p>Let us illustrate our point with an example.</p>
<figure>
<img src="../fig/kmeans.svg" alt="Euclidean k-means" width="100%" />
<figcaption>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means clustering with Euclidean distance. Each subfigure represents series from a given cluster and their centroid (in red).
</figcaption>
</figure>
<p>The figure above is the result of a <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means clustering that uses Euclidean distance as a base metric. One issue with this metric is that it is not invariant to time shifts, while the dataset at stake clearly holds such invariants.</p>
<p>When using a shift-invariant similarity measure (discussed in our {ref}<code>sec:dtw</code> section) at the core of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means, one gets:</p>
<figure>
<img src="../fig/kmeans_dtw.svg" alt="Euclidean k-means" width="100%" />
<figcaption>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means clustering with Dynamic Time Warping. Each subfigure represents series from a given cluster and their centroid (in red).
</figcaption>
</figure>
<p>This part of the course tackles the definition of adequate similarity measures for time series and their use at the core of machine learning methods.</p>
<h1 data-number="2" id="dynamic-time-warping"><span class="header-section-number">2</span> Dynamic Time Warping</h1>
<p>This section covers works related to Dynamic Time Warping for time series.</p>
<p>Dynamic Time Warping (DTW) <span class="citation" data-cites="sakoe1978dynamic">(<a href="#ref-sakoe1978dynamic" role="doc-biblioref">Sakoe and Chiba 1978</a>)</span> is a similarity measure between time series. Consider two time series <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><annotation encoding="application/x-tex">\mathbf{x}^\prime</annotation></semantics></math> of respective lengths <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>. Here, all elements <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>x</mi><mi>j</mi><mi>&#x2032;</mi></msubsup><annotation encoding="application/x-tex">x^\prime_j</annotation></semantics></math> are assumed to lie in the same <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-dimensional space and the exact timestamps at which observations occur are disregarded: only their ordering matters.</p>
<h2 data-number="2.1" id="optimization-problem"><span class="header-section-number">2.1</span> Optimization Problem</h2>
<p>In the following, a path <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>&#x3C0;</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math> of length <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math> is a sequence of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math> index pairs <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>i</mi><mn>0</mn></msub><mo>,</mo><msub><mi>j</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>&#x2026;</mi><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>i</mi><mrow><mi>K</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>j</mi><mrow><mi>K</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\left((i_0, j_0), \dots , (i_{K-1}, j_{K-1})\right)</annotation></semantics></math>.</p>
<p>DTW between <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><annotation encoding="application/x-tex">\mathbf{x}^\prime</annotation></semantics></math> is formulated as the following optimization problem:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>T</mi><msub><mi>W</mi><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>min</mo><mrow><mi>&#x3C0;</mi><mo>&#x2208;</mo><mstyle mathvariant="script"><mi>&#x1D49C;</mi></mstyle><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow></munder><msup><mrow><mo stretchy="true" form="prefix">(</mo><munder><mo>&#x2211;</mo><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&#x2208;</mo><mi>&#x3C0;</mi></mrow></munder><mi>d</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msubsup><mi>x</mi><mi>j</mi><mi>&#x2032;</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>q</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow><mfrac><mn>1</mn><mi>q</mi></mfrac></msup></mrow><annotation encoding="application/x-tex">\begin{equation}
DTW_q(\mathbf{x}, \mathbf{x}^\prime) =
    \min_{\pi \in \mathcal{A}(\mathbf{x}, \mathbf{x}^\prime)}
        \left( \sum_{(i, j) \in \pi} d(x_i, x^\prime_j)^q \right)^{\frac{1}{q}}
\label{eq:dtw}
\end{equation}</annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathvariant="script"><mi>&#x1D49C;</mi></mstyle><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{A}(\mathbf{x}, \mathbf{x}^\prime)</annotation></semantics></math> is the set of all admissible paths, <em>i.e.</em> the set of paths <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>&#x3C0;</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math> such that:</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>&#x3C0;</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math> is a sequence <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>&#x3C0;</mi><mn>0</mn></msub><mo>,</mo><mi>&#x2026;</mi><mo>,</mo><msub><mi>&#x3C0;</mi><mrow><mi>K</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[\pi_0, \dots , \pi_{K-1}]</annotation></semantics></math> of index pairs <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>&#x3C0;</mi><mi>k</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>i</mi><mi>k</mi></msub><mo>,</mo><msub><mi>j</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi_k = (i_k, j_k)</annotation></semantics></math> with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&#x2264;</mo><msub><mi>i</mi><mi>k</mi></msub><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">0 \leq i_k &lt; n</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&#x2264;</mo><msub><mi>j</mi><mi>k</mi></msub><mo>&lt;</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">0 \leq j_k &lt; m</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>&#x3C0;</mi><mn>0</mn></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi_0 = (0, 0)</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>&#x3C0;</mi><mrow><mi>K</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>&#x2212;</mo><mn>1</mn><mo>,</mo><mi>m</mi><mo>&#x2212;</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi_{K-1} = (n - 1, m - 1)</annotation></semantics></math></p></li>
<li><p>for all <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k &gt; 0</annotation></semantics></math> , <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>&#x3C0;</mi><mi>k</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>i</mi><mi>k</mi></msub><mo>,</mo><msub><mi>j</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi_k = (i_k, j_k)</annotation></semantics></math> is related to <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>&#x3C0;</mi><mrow><mi>k</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>i</mi><mrow><mi>k</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>j</mi><mrow><mi>k</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi_{k-1} = (i_{k-1}, j_{k-1})</annotation></semantics></math> as follows:</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>i</mi><mrow><mi>k</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>&#x2264;</mo><msub><mi>i</mi><mi>k</mi></msub><mo>&#x2264;</mo><msub><mi>i</mi><mrow><mi>k</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i_{k-1} \leq i_k \leq i_{k-1} + 1</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>j</mi><mrow><mi>k</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>&#x2264;</mo><msub><mi>j</mi><mi>k</mi></msub><mo>&#x2264;</mo><msub><mi>j</mi><mrow><mi>k</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">j_{k-1} \leq j_k \leq j_{k-1} + 1</annotation></semantics></math></li>
</ul></li>
</ul>
<p>In what follows, we will denote <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>T</mi><msub><mi>W</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">DTW_2</annotation></semantics></math> as DTW. In this context, a path can be seen as a temporal alignment of time series and the optimal path is such that Euclidean distance between aligned (<em>ie.</em> resampled) time series is minimal.</p>
<p>The following image exhibits the DTW path (in white) for a given pair of time series, on top of the cross-similarity matrix that stores <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msubsup><mi>x</mi><mi>j</mi><mi>&#x2032;</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">d(x_i, {x}^\prime_j)</annotation></semantics></math> values:</p>
<h2 data-number="2.2" id="algorithmic-solution"><span class="header-section-number">2.2</span> Algorithmic Solution</h2>
<p>There exists an <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">O(mn)</annotation></semantics></math> algorithm to compute the exact optimum for this problem (assuming computation of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>&#x22C5;</mo><mo>,</mo><mo>&#x22C5;</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">d(\cdot,\cdot)</annotation></semantics></math> is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math>):</p>
<pre>
  <code class="language-python">
def dtw(x, x_prime, q=2):
  for i in 1..n:
    for j in 1..m:
      dist = d(x[i], x_prime[j]) ** q
      if i == 1 and j == 1:
        gamma[i, j] = dist
      else:
        gamma[i, j] = dist + min(gamma[i-1, j] if i > 1
                                               else inf,
                                 gamma[i, j-1] if j > 1
                                               else inf,
                                 gamma[i-1, j-1] if (i > 1 and j > 1)
                                                 else inf)

  return (gamma[n, m]) ** (1. / q)
  </code>
</pre>
<p>The basic idea behind this algorithm is that there exists a recurrence relationship between partial DTW computations. More precisely, if we denote by <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>&#x3B3;</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\gamma_{i,j}</annotation></semantics></math> the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>T</mi><msub><mi>W</mi><mi>q</mi></msub></mrow><annotation encoding="application/x-tex">DTW_q</annotation></semantics></math> (at power <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>) similarity between sequences <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>&#x2192;</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">\mathbf{x}_{\rightarrow i}</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>&#x2192;</mo><mi>j</mi></mrow><mi>&#x2032;</mi></msubsup><annotation encoding="application/x-tex">\mathbf{x}^\prime_{\rightarrow j}</annotation></semantics></math> (where the notation <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>&#x2192;</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">\mathbf{x}_{\rightarrow i}</annotation></semantics></math> denotes sequence <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math> observed up to time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>), then we have:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right"><msub><mi>&#x3B3;</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub></mtd><mtd columnalign="left"><mo>=</mo></mtd><mtd columnalign="right"><mi>D</mi><mi>T</mi><msub><mi>W</mi><mi>q</mi></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>&#x2192;</mo><mi>i</mi></mrow></msub><mo>,</mo><msubsup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>&#x2192;</mo><mi>j</mi></mrow><mi>&#x2032;</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>q</mi></msup></mtd></mtr><mtr><mtd columnalign="right"></mtd><mtd columnalign="left"><mo>=</mo></mtd><mtd columnalign="right"><munder><mo>min</mo><mrow><mi>&#x3C0;</mi><mo>&#x2208;</mo><mstyle mathvariant="script"><mi>&#x1D49C;</mi></mstyle><mrow><mo stretchy="true" form="prefix">(</mo><msub><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>&#x2192;</mo><mi>i</mi></mrow></msub><mo>,</mo><msubsup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>&#x2192;</mo><mi>j</mi></mrow><mi>&#x2032;</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow></munder><munder><mo>&#x2211;</mo><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo>,</mo><mi>l</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&#x2208;</mo><mi>&#x3C0;</mi></mrow></munder><mi>d</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>k</mi></msub><mo>,</mo><msubsup><mi>x</mi><mi>l</mi><mi>&#x2032;</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>q</mi></msup></mtd></mtr><mtr><mtd columnalign="right"></mtd><mtd columnalign="left"><mover><mo>=</mo><mo accent="false">*</mo></mover></mtd><mtd columnalign="right"><mi>d</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msubsup><mi>x</mi><mi>j</mi><mi>&#x2032;</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>q</mi></msup><mo>+</mo><munder><mo>min</mo><mrow><mi>&#x3C0;</mi><mo>&#x2208;</mo><mstyle mathvariant="script"><mi>&#x1D49C;</mi></mstyle><mrow><mo stretchy="true" form="prefix">(</mo><msub><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>&#x2192;</mo><mi>i</mi></mrow></msub><mo>,</mo><msubsup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>&#x2192;</mo><mi>j</mi></mrow><mi>&#x2032;</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow></munder><munder><mo>&#x2211;</mo><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo>,</mo><mi>l</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&#x2208;</mo><mi>&#x3C0;</mi><mrow><mo stretchy="true" form="prefix">[</mo><mo>:</mo><mo>&#x2212;</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></munder><mi>d</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>k</mi></msub><mo>,</mo><msubsup><mi>x</mi><mi>l</mi><mi>&#x2032;</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>q</mi></msup></mtd></mtr><mtr><mtd columnalign="right"></mtd><mtd columnalign="left"><mover><mo>=</mo><mrow><mo>*</mo><mo>*</mo></mrow></mover></mtd><mtd columnalign="right"><mi>d</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msubsup><mi>x</mi><mi>j</mi><mi>&#x2032;</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mi>q</mi></msup><mo>+</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>&#x3B3;</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn><mo>,</mo><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>&#x3B3;</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>&#x3B3;</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn><mo>,</mo><mi>j</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\gamma_{i,j} &amp;=&amp; DTW_q(\mathbf{x}_{\rightarrow i}, \mathbf{x}^\prime_{\rightarrow j})^q \\
&amp;=&amp;
    \min_{\pi \in \mathcal{A}(\mathbf{x}_{\rightarrow i}, \mathbf{x}^\prime_{\rightarrow j})}
        \sum_{(k, l) \in \pi} d(x_k, x^\prime_l)^q \\
&amp;\stackrel{*}{=}&amp; d(x_i, x^\prime_j)^q +
    \min_{\pi \in \mathcal{A}(\mathbf{x}_{\rightarrow i}, \mathbf{x}^\prime_{\rightarrow j})}
        \sum_{(k, l) \in \pi[:-1]} d(x_k, x^\prime_l)^q \\
&amp;\stackrel{**}{=}&amp; d(x_i, x^\prime_j)^q +
    \min (\gamma_{i-1, j}, \gamma_{i, j-1}, \gamma_{i-1, j-1})
\end{aligned}
</annotation></semantics></math></p>
<p>and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>T</mi><msub><mi>W</mi><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">DTW_q(\mathbf{x}, \mathbf{x}^\prime)</annotation></semantics></math> is then <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>&#x3B3;</mi><mrow><mi>n</mi><mo>,</mo><mi>m</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mfrac><mn>1</mn><mi>q</mi></mfrac></msup><annotation encoding="application/x-tex">(\gamma_{n, m})^{\frac{1}{q}}</annotation></semantics></math>. In more details:</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mo>*</mo><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(*)</annotation></semantics></math> comes from the constraints on admissible paths <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>&#x3C0;</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>: the last element on an admissible path needs to match the last elements of the series;</li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mo>*</mo><mo>*</mo><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(**)</annotation></semantics></math> comes from the contiguity conditions on the admissible paths: all admissible paths that match <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math> with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>x</mi><mi>j</mi><mi>&#x2032;</mi></msubsup><annotation encoding="application/x-tex">x^\prime_j</annotation></semantics></math> need to go through one of these 3 possible ancestors: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>&#x2212;</mo><mn>1</mn><mo>,</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(i-1, j)</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo>&#x2212;</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(i, j-1)</annotation></semantics></math> or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>&#x2212;</mo><mn>1</mn><mo>,</mo><mi>j</mi><mo>&#x2212;</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(i-1, j-1)</annotation></semantics></math>.</li>
</ul>
<p>The dynamic programming algorithm presented above relies on this recurrence formula and stores intermediate computations for efficiency.</p>
<p><label for="sn-anything" class="sidenote-toggle">&#x2295;</label> <input type="checkbox" id="sn-anything" class="sidenote-toggle" /> <span class="sidenote"> <strong>Dot product notation</strong></p>
<pre><code>Dynamic Time Warping can also be formalized using the following</code></pre>
<p>notation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>T</mi><msub><mi>W</mi><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>min</mo><mrow><mi>&#x3C0;</mi><mo>&#x2208;</mo><mstyle mathvariant="script"><mi>&#x1D49C;</mi></mstyle><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow></munder><mo stretchy="false" form="prefix">&#x27E8;</mo><msub><mi>A</mi><mi>&#x3C0;</mi></msub><mo>,</mo><msub><mi>D</mi><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow><msup><mo stretchy="false" form="postfix">&#x27E9;</mo><mfrac><mn>1</mn><mi>q</mi></mfrac></msup></mrow><annotation encoding="application/x-tex">\begin{equation*}
DTW_q(\mathbf{x}, \mathbf{x}^\prime) =
    \min_{\pi \in \mathcal{A}(\mathbf{x}, \mathbf{x}^\prime)}
        \langle A_\pi,  D_q(\mathbf{x}, \mathbf{x}^\prime) \rangle^{\frac{1}{q}}
\end{equation*}</annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">D_q(\mathbf{x}, \mathbf{x}^\prime)</annotation></semantics></math> stores distances <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msubsup><mi>x</mi><mi>j</mi><mi>&#x2032;</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">d(x_i, x^\prime_j)</annotation></semantics></math> at the power <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math> and <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>A</mi><mi>&#x3C0;</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="right"><mn>1</mn></mtd><mtd columnalign="left"><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> if </mtext><mspace width="0.333em"></mspace></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&#x2208;</mo><mi>&#x3C0;</mi></mtd></mtr><mtr><mtd columnalign="right"><mn>0</mn></mtd><mtd columnalign="left"><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> otherwise</mtext></mrow></mtd></mtr></mtable></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
(A_\pi)_{i,j} = \left\{ \begin{array}{rl} 1 &amp; \text{ if } (i, j) \in \pi \\
                                      0 &amp; \text{ otherwise}
                        \end{array} \right. .
\end{equation}</annotation></semantics></math> </span></p>
<h2 data-number="2.3" id="properties"><span class="header-section-number">2.3</span> Properties</h2>
<p>Dynamic Time Warping holds the following properties:</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&#x2200;</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><mo>,</mo><mi>D</mi><mi>T</mi><msub><mi>W</mi><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msup><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mi>&#x2032;</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>&#x2265;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\forall \mathbf{x}, \mathbf{x}^\prime, DTW_q(\mathbf{x}, \mathbf{x}^\prime) \geq 0</annotation></semantics></math></li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&#x2200;</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><mi>D</mi><mi>T</mi><msub><mi>W</mi><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\forall \mathbf{x}, DTW_q(\mathbf{x}, \mathbf{x}) = 0</annotation></semantics></math></li>
<li>Suppose <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math> is a time series that is constant except for a motif that occurs at some point in the series, and let us denote by <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>+</mo><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\mathbf{x}_{+k}</annotation></semantics></math> a copy of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math> in which the motif is temporally shifted by <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> timestamps, then <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>T</mi><msub><mi>W</mi><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mo>,</mo><msub><mstyle mathvariant="bold"><mi>&#x1D431;</mi></mstyle><mrow><mo>+</mo><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">DTW_q(\mathbf{x}, \mathbf{x}_{+k}) = 0</annotation></semantics></math>.</li>
</ul>
<p>However, mathematically speaking, DTW is not a valid metric since it satisfies neither the triangular inequality nor the identity of indiscernibles.</p>
<h2 data-number="2.4" id="setting-additional-constraints"><span class="header-section-number">2.4</span> Setting Additional Constraints</h2>
<p>The set of temporal deformations to which DTW is invariant can be reduced by imposing additional constraints on the set of acceptable paths. Such constraints typically consist in forcing paths to stay close to the diagonal.</p>
<p>The Sakoe-Chiba band is parametrized by a radius <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math> (number of off-diagonal elements to consider, also called warping window size sometimes), as illustrated below:</p>
<p>The Itakura parallelogram sets a maximum slope <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math> for alignment paths, which leads to a parallelogram-shaped constraint:</p>
<h1 class="unnumbered" id="bibliography">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-sakoe1978dynamic" class="csl-entry" role="doc-biblioentry">
Sakoe, Hiroaki, and Seibi Chiba. 1978. <span>&#x201C;Dynamic Programming Algorithm Optimization for Spoken Word Recognition.&#x201D;</span> <em>IEEE Transactions on Acoustics, Speech and Signal Processing</em> 26 (1): 43&#x2013;49.
</div>
</div>
</body>
</html>
